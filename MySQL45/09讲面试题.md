本文档作为草稿，不定期删除。
## 读数据页
InnoDB的数据是按数据页为单位来读写的。也就是说，当需要读一条记录的时候，并不是将这个记录本身从磁盘读出来，而是以页为单位，将其整体读入内存。在InnoDB中，每个数据页的大小默认是16KB。

## 更新数据
*   如果被更新的数据页在内存中，直接更新。
*   如果不在，更新操作缓存在changebuffer中。下次查询时需要访问这个数据页时，读入内存，然后执行chagebuffer的操作。
    （后台也有线程会定期调用changebuffer，merge数据）

changebuffer可以持久化数据，在内存中有拷贝，会被写入磁盘中。

唯一索引不使用changebuffer。   
普通索引使用changebuffer。   

 


例子：
```
之前我就碰到过一件事儿，有个DBA的同学跟我反馈说，他负责的某个业务的库内存命中率突然从99%降低到了75%，整个系统处于阻塞状态，更新语句全部堵住。而探究其原因后，我发现这个业务有大量插入数据的操作，而他在前一天把其中的某个普通索引改成了唯一索引。
```

changebuffer适用于：一个数据页做merge之前，change buffer记录的变更越多（也就是这个页面上要更新的次数越多），收益就越大。



## 重点：
将数据从磁盘读入内存涉及随机IO的访问，是数据库里面成本最高的操作之一。change buffer因为减少了随机磁盘访问，所以对更新性能的提升是会很明显的。（顺序读写则很快，比如redolog是顺序写。）

